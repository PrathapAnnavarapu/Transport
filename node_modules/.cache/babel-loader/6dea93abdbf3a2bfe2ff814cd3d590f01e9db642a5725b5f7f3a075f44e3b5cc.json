{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\annavarapu.7\\\\Transport-frontend\\\\src\\\\Pages\\\\Schedules\\\\PickupGroupingSchedules.js\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect, useState, useRef } from 'react';\nimport ApiComponent from '../../Components/API';\nimport DatePicker from 'react-datepicker';\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';\nimport { FaPlus, FaArrowRight } from 'react-icons/fa';\nimport { IoCheckmarkCircleOutline } from 'react-icons/io5';\nimport TimePicker from 'react-time-picker';\nimport Dropdown from '../../Components/Dropdown';\nimport ClusterMapModal from '../../Components/ClusterMapModel';\nimport ToastComponent from '../../Components/Toast';\nimport { TrendingUp, TrendingDown, DollarSign, Users, FileText, CheckCircle, Bus } from 'lucide-react';\nimport 'react-datepicker/dist/react-datepicker.css';\nimport 'react-time-picker/dist/TimePicker.css';\nimport 'leaflet/dist/leaflet.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst StatsCard = ({\n  label,\n  value,\n  icon,\n  color,\n  footer,\n  trend\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"stats-card\",\n  children: /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"card-top\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"card-label\",\n        children: label\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 28,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"card-value\",\n        children: value\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 29,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 27,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `icon-container ${color}`,\n      children: icon\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 31,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 26,\n    columnNumber: 9\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 25,\n  columnNumber: 5\n}, this);\n_c = StatsCard;\nconst PickupGroupingSchedules = () => {\n  _s();\n  const {\n    info,\n    error,\n    success\n  } = ToastComponent();\n  const [manualClusters, setManualClusters] = useState({});\n  const [selectedDate, setSelectedDate] = useState(() => new Date());\n  const [apiProps, setApiProps] = useState(null);\n  const [editable, setEditable] = useState({});\n  const [vechilesList, setVechileList] = useState([]);\n  const [mapClusterData, setMapClusterData] = useState(null);\n  const [routingStatus, setRoutingStatus] = useState({});\n  const prevManualClustersRef = useRef();\n  const totalRoutes = Object.keys(manualClusters).reduce((acc, pickupTime) => {\n    return acc + Object.keys(manualClusters[pickupTime]).length;\n  }, 0);\n  const totalEmployees = Object.values(manualClusters).reduce((acc, clusters) => {\n    return acc + Object.values(clusters).reduce((clusterAcc, clusterData) => {\n      var _clusterData$employee;\n      return clusterAcc + ((clusterData === null || clusterData === void 0 ? void 0 : (_clusterData$employee = clusterData.employeeList) === null || _clusterData$employee === void 0 ? void 0 : _clusterData$employee.length) || 0);\n    }, 0);\n  }, 0);\n  useEffect(() => {\n    const prevManualClusters = prevManualClustersRef.current;\n    if (prevManualClusters && JSON.stringify(prevManualClusters) !== JSON.stringify(manualClusters)) {\n      const groupedByDate = new Map(); // Map<shiftDate, Set<pickupTime>>\n\n      Object.entries(manualClusters).forEach(([pickupTime, clusters]) => {\n        Object.entries(clusters).forEach(([clusterId, cluster]) => {\n          var _employeeList$;\n          const employeeList = cluster.employeeList;\n          const shiftDate = employeeList && ((_employeeList$ = employeeList[0]) === null || _employeeList$ === void 0 ? void 0 : _employeeList$.shift_date);\n          if (shiftDate) {\n            if (!groupedByDate.has(shiftDate)) {\n              groupedByDate.set(shiftDate, new Set());\n            }\n            groupedByDate.get(shiftDate).add(pickupTime);\n          }\n        });\n      });\n\n      // Send one request per shift date with all its pickup times\n      groupedByDate.forEach((pickupTimesSet, shiftDate) => {\n        const pickupTimes = Array.from(pickupTimesSet);\n        fetchRoutingDetails(pickupTimes, shiftDate);\n      });\n    }\n    prevManualClustersRef.current = manualClusters;\n  }, [manualClusters]);\n  const fetchRoutingDetails = (pickupTimes, shiftDate) => {\n    setApiProps({\n      method: 'POST',\n      url: 'api/get/pickup/routing-details',\n      postData: JSON.stringify({\n        pickup_time: pickupTimes,\n        // Now an array\n        shift_date: shiftDate\n      }),\n      render: detailsResponse => {\n        if (detailsResponse.status === 200 && Array.isArray(detailsResponse.data.data)) {\n          // Filter for both 'Routing Done', 'Picked Up', and 'Completed' statuses\n          const allRoutingData = detailsResponse.data.data.filter(item => item.routing && ['Routing Done', 'Picked Up', 'Completed'].includes(item.routing.pickup_trip_status));\n          if (allRoutingData.length > 0) {\n            setManualClusters(prevManualClusters => {\n              const updatedClusters = {\n                ...prevManualClusters\n              };\n              const newRoutingStatus = {};\n              const clustersToRemove = new Set(); // To track clusters to be removed\n\n              allRoutingData.forEach(item => {\n                var _item$vehicle, _item$vehicle2, _item$vehicle3;\n                const group = item.schedule.pickup_time; // pickup_time is the group\n                const clusterId = item.cluster_id;\n                const vehicleNumber = (item === null || item === void 0 ? void 0 : (_item$vehicle = item.vehicle) === null || _item$vehicle === void 0 ? void 0 : _item$vehicle.vechile_number) || null;\n                const vechile_id = (item === null || item === void 0 ? void 0 : (_item$vehicle2 = item.vehicle) === null || _item$vehicle2 === void 0 ? void 0 : _item$vehicle2.vechile_id) || null;\n                const vehicleOwnerName = (item === null || item === void 0 ? void 0 : (_item$vehicle3 = item.vehicle) === null || _item$vehicle3 === void 0 ? void 0 : _item$vehicle3.vechile_owner_name) || null;\n                const employeeList = item.employeeList || []; // Assuming the employee list is in the API response\n                const status = item.routing.pickup_trip_status; // Either 'Routing Done', 'Picked Up', or 'Completed'\n\n                // Check if the cluster and group already exist in the state\n                if (updatedClusters[group] && updatedClusters[group][clusterId]) {\n                  const currentCluster = updatedClusters[group][clusterId];\n\n                  // Add vehicle details if they are not already set\n                  if (vehicleNumber && (!currentCluster.vehicleDetails || currentCluster.vehicleDetails.vechile_number !== vehicleNumber)) {\n                    currentCluster.vehicleDetails = {\n                      vechile_number: vehicleNumber,\n                      vechile_owner_name: vehicleOwnerName,\n                      vechile_id: vechile_id\n                    };\n                  }\n\n                  // Replace the current employees with the new employeeList\n                  if (Array.isArray(employeeList) && employeeList.length > 0) {\n                    currentCluster.employees = employeeList; // Replace employees with employeeList from the API\n                  }\n\n                  // Set routing status to either 'completed' or 'routing done', or 'Trip in progress' for 'Picked Up'\n                  if (status === 'Completed') {\n                    newRoutingStatus[`${group}__${clusterId}`] = 'completed';\n                  } else if (status === 'Picked Up') {\n                    newRoutingStatus[`${group}__${clusterId}`] = 'Trip in progress'; // Update here\n                  } else {\n                    newRoutingStatus[`${group}__${clusterId}`] = 'routing done';\n                  }\n\n                  // If the status is 'Completed', we need to mark this cluster for removal\n                  if (status === 'Completed') {\n                    clustersToRemove.add(`${group}__${clusterId}`);\n                  }\n                }\n              });\n\n              // Remove the clusters that are marked for removal\n              clustersToRemove.forEach(clusterKey => {\n                const [pickupTime, clusterId] = clusterKey.split('__');\n                if (updatedClusters[pickupTime] && updatedClusters[pickupTime][clusterId]) {\n                  delete updatedClusters[pickupTime][clusterId];\n\n                  // If the pickup group has no clusters left, delete the entire pickup group\n                  if (Object.keys(updatedClusters[pickupTime]).length === 0) {\n                    delete updatedClusters[pickupTime];\n                  }\n                }\n              });\n\n              // Filter out any pickup groups that are empty (i.e., they don't have any clusters after removal)\n              Object.keys(updatedClusters).forEach(group => {\n                if (Object.keys(updatedClusters[group]).length === 0) {\n                  delete updatedClusters[group]; // Remove the empty pickup group\n                }\n              });\n\n              // Update routing status\n              setRoutingStatus(prev => ({\n                ...prev,\n                ...newRoutingStatus\n              }));\n\n              // Return the updated clusters after filtering out empty groups\n              return updatedClusters;\n            });\n          } else {\n            // Handle case where no routing data is available\n            // info('No routing data found for the selected date.');\n          }\n        } else {\n          error(\"Failed to fetch routing details.\");\n        }\n      }\n    });\n  };\n\n  // Fetch schedules on date change\n  useEffect(() => {\n    if (selectedDate) {\n      fetchSchedules(selectedDate, () => {\n        fetchVehicleList();\n      });\n    }\n  }, [selectedDate]);\n  const fetchSchedules = (date, onComplete) => {\n    const formattedDate = date.toISOString().split('T')[0];\n    setApiProps({\n      method: 'POST',\n      url: 'api/get/pickup/clustered-routes',\n      postData: {\n        date: formattedDate\n      },\n      render: response => {\n        const optimizedRoutes = response.data.optimized_routes || [];\n        const initialClusters = {};\n        optimizedRoutes.forEach(route => {\n          const pickupTime = route.pickup_time_group;\n          const clusters = {};\n          route.clusters.forEach((cl, idx) => {\n            clusters[`cluster${idx + 1}`] = {\n              employeeList: cl.pickup_sequence,\n              routeName: cl.route_name,\n              vehicleDetails: null\n            };\n          });\n          initialClusters[pickupTime] = clusters;\n        });\n        setManualClusters(initialClusters);\n        setRoutingStatus({});\n        if (onComplete) onComplete(); // Trigger next step\n      }\n    });\n  };\n\n  // Fetch vehicle list\n  const fetchVehicleList = () => {\n    if (vechilesList.length === 0) {\n      setApiProps({\n        method: 'GET',\n        url: 'api/get/vechile/all',\n        render: response => {\n          if (response) {\n            setVechileList(response.data);\n          } else {\n            console.error('No response received from API');\n          }\n        },\n        onError: error => {\n          console.error('Error fetching vehicles:', error);\n        }\n      });\n    }\n  };\n\n  // Save cluster changes\n  const saveClusterChanges = (pickupTime, clusterId, empIndex) => {\n    var _cluster$employeeList;\n    const cluster = manualClusters[pickupTime][clusterId];\n    if (!cluster) {\n      console.error(\"Cluster not found.\");\n      return;\n    }\n    const shiftDate = (_cluster$employeeList = cluster.employeeList[0]) === null || _cluster$employeeList === void 0 ? void 0 : _cluster$employeeList.shift_date;\n    const employee = cluster.employeeList[empIndex];\n    if (!employee) {\n      console.error('Employee not found at the given index');\n      return;\n    }\n\n    // Update the relevant employee's details\n    cluster.employeeList[empIndex] = {\n      ...employee,\n      pickup_sequence: employee.pickup_sequence,\n      // (if modified)\n      calculated_pickup_time: employee.calculated_pickup_time,\n      // (if modified)\n      distance_from_last: employee.distance_from_last || 0,\n      // Handle undefined\n      cumulative_distance: employee.cumulative_distance || 0 // Handle undefined\n    };\n    const payload = {\n      clusters: manualClusters,\n      date: shiftDate\n    };\n    setApiProps({\n      method: 'PUT',\n      url: `api/get/pickup/updated/manual-clustered-details/${employee.employee_id}/${employee.schedule_id}`,\n      postData: JSON.stringify(payload),\n      // Ensure the payload is stringified\n      render: response => {\n        if (response.status === 200) {\n          success(\"Changes saved successfully.\");\n          fetchRoutingDetails([pickupTime], shiftDate);\n        } else {\n          error((response === null || response === void 0 ? void 0 : response.message) || \"Failed to save changes.\");\n        }\n      }\n    });\n  };\n\n  // Add a new cluster to the pickup time\n  const addNewCluster = pickupTime => {\n    setManualClusters(prev => {\n      const current = prev[pickupTime] || {};\n      const newClusterId = `cluster${Object.keys(current).length + 1}`;\n      return {\n        ...prev,\n        [pickupTime]: {\n          ...current,\n          [newClusterId]: {\n            employeeList: [],\n            vehicleDetails: null\n          }\n        }\n      };\n    });\n  };\n\n  // Handle \"Optimize Routing\" button click\n  const handleProceed = useCallback((pickupTime, clusterId) => {\n    const cluster = manualClusters[pickupTime][clusterId];\n    if (!cluster.vehicleDetails) {\n      ToastComponent().error(\"Please select a vehicle\");\n      return;\n    }\n    const postCluster = {\n      [pickupTime]: [{\n        ...cluster,\n        clusterId: clusterId\n      }]\n    };\n    setApiProps({\n      method: 'POST',\n      url: 'api/get/pickup-routing',\n      postData: JSON.stringify(postCluster),\n      render: response => {\n        var _cluster$employeeList2;\n        const result = response.data;\n        if (!result || !result.route || !Array.isArray(result.route)) {\n          console.error(\"Invalid response format: 'route' array not found\", result);\n          error(\"Failed to update routing. Invalid response format.\");\n          return;\n        }\n        const updated = {\n          ...manualClusters\n        };\n        const newRoute = result.route.find(r => r.pickup_time_group === pickupTime);\n        if (newRoute) {\n          newRoute.clusters.forEach((cl, idx) => {\n            const clusterKey = Object.keys(updated[pickupTime])[idx] || `cluster${idx + 1}`;\n            updated[pickupTime][clusterKey].employeeList = cl.pickup_sequence;\n            const tripStatus = cl.trip_status;\n            if (tripStatus) {\n              setRoutingStatus(prev => ({\n                ...prev,\n                [`${pickupTime}__${clusterKey}`]: tripStatus\n              }));\n            }\n            // saveClusterChanges(pickupTime, clusterKey);\n          });\n        }\n        setManualClusters(updated);\n\n        // âœ… Get shift_date from first employee in the cluster\n        const shiftDate = (_cluster$employeeList2 = cluster.employeeList[0]) === null || _cluster$employeeList2 === void 0 ? void 0 : _cluster$employeeList2.shift_date;\n        if (shiftDate) {\n          fetchRoutingDetails([pickupTime], shiftDate); // Send as list\n        } else {\n          console.warn(\"Shift date not found in cluster data\");\n        }\n      }\n    });\n  }, [manualClusters, success, error, info]);\n\n  // Handle drag-and-drop behavior\n  const onDragEnd = result => {\n    const {\n      source,\n      destination\n    } = result;\n    if (!destination || source.droppableId === destination.droppableId && source.index === destination.index) return;\n    const [sourceTime, sourceCluster] = source.droppableId.split('__');\n    const [destTime, destCluster] = destination.droppableId.split('__');\n    if (sourceTime !== destTime) return;\n    const sourceItems = Array.from(manualClusters[sourceTime][sourceCluster].employeeList);\n    const destItems = Array.from(manualClusters[destTime][destCluster].employeeList);\n    const [movedItem] = sourceItems.splice(source.index, 1);\n\n    // Prevent moving an employee if they already exist in the destination\n    if (destItems.some(emp => emp.employee_id === movedItem.employee_id)) return;\n\n    // Move the item to the destination\n    destItems.splice(destination.index, 0, movedItem);\n\n    // Update the clusters with the new data\n    const updatedClusters = {\n      ...manualClusters,\n      [sourceTime]: {\n        ...manualClusters[sourceTime],\n        [sourceCluster]: {\n          ...manualClusters[sourceTime][sourceCluster],\n          employeeList: sourceItems\n        },\n        [destCluster]: {\n          ...manualClusters[destTime][destCluster],\n          employeeList: destItems\n        }\n      }\n    };\n\n    // Remove any empty clusters before sending the data to the API\n    Object.keys(updatedClusters[sourceTime]).forEach(cluster => {\n      if (updatedClusters[sourceTime][cluster].employeeList.length === 0) {\n        delete updatedClusters[sourceTime][cluster];\n      }\n    });\n    Object.keys(updatedClusters[destTime]).forEach(cluster => {\n      if (updatedClusters[destTime][cluster].employeeList.length === 0) {\n        delete updatedClusters[destTime][cluster];\n      }\n    });\n    setManualClusters(updatedClusters);\n\n    // Update routing status\n    setRoutingStatus(prev => ({\n      ...prev,\n      [`${sourceTime}__${sourceCluster}`]: false,\n      [`${destTime}__${destCluster}`]: false\n    }));\n    const shiftDate = (movedItem === null || movedItem === void 0 ? void 0 : movedItem.shift_date) || new Date().toISOString().split(\"T\")[0];\n    const isoDate = `${shiftDate}T${sourceTime}`;\n    const payload = {\n      clusters: updatedClusters,\n      date: isoDate // Correct ISO 8601 format\n    };\n\n    // Call the API to save the updated clusters\n    setApiProps({\n      method: 'POST',\n      url: 'api/get/pickup/updated/manual-clustered-routes',\n      postData: JSON.stringify(payload),\n      // Ensure payload is stringified\n      render: response => {\n        if (response.status === 200) {\n          success(\"Saved successfully.\");\n          fetchSchedules(shiftDate);\n        } else {\n          error((response === null || response === void 0 ? void 0 : response.message) || \"Failed to save changes.\");\n        }\n      }\n    });\n  };\n\n  // Update employee values\n  const updateEmployeeValue = (pickupTime, clusterId, empIndex, key, value) => {\n    setManualClusters(prev => {\n      const updated = {\n        ...prev\n      };\n      const cluster = [...updated[pickupTime][clusterId].employeeList];\n      cluster[empIndex][key] = value;\n      updated[pickupTime][clusterId].employeeList = cluster;\n      return updated;\n    });\n  };\n  const toggleEdit = (pickupTime, clusterId, empIndex) => {\n    const key = `${pickupTime}__${clusterId}__${empIndex}`;\n    const wasEditing = editable[key];\n    setEditable(prev => ({\n      ...prev,\n      [key]: !prev[key]\n    }));\n    if (wasEditing === true) {\n      saveClusterChanges(pickupTime, clusterId, empIndex);\n    }\n  };\n  const getValidTime = timeStr => {\n    if (!timeStr || typeof timeStr !== 'string') return '00:00';\n    const match = timeStr.match(/^(\\d{2}):(\\d{2})/);\n    return match ? match[0] : '00:00';\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pick-grouping-main-container\",\n    children: [apiProps && /*#__PURE__*/_jsxDEV(ApiComponent, {\n      ...apiProps\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 512,\n      columnNumber: 26\n    }, this), mapClusterData && /*#__PURE__*/_jsxDEV(ClusterMapModal, {\n      clusterData: mapClusterData,\n      onClose: () => setMapClusterData(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 513,\n      columnNumber: 32\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grouping-schediles-with-datepicker-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Pickup Schedules\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 515,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(DatePicker, {\n        selected: selectedDate,\n        onChange: date => {\n          if (date) setSelectedDate(date);\n        },\n        className: \"date-range-picker\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 516,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 514,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(DragDropContext, {\n      onDragEnd: onDragEnd,\n      children: Object.keys(manualClusters).length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"no-schedules-message\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"/Images/897245_clock_manage_schedule_time_icon.png\",\n          alt: \"schedule\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 527,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"No schedules available.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 531,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 526,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grouped-schedules-list\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"stats-grid\",\n          children: [/*#__PURE__*/_jsxDEV(StatsCard, {\n            label: \"Total Routes\",\n            value: totalRoutes,\n            icon: /*#__PURE__*/_jsxDEV(Bus, {\n              className: \"icon green\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 539,\n              columnNumber: 39\n            }, this),\n            color: \"green-bg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 536,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(StatsCard, {\n            label: \"Total Employees\",\n            value: totalEmployees,\n            icon: /*#__PURE__*/_jsxDEV(Users, {\n              className: \"icon blue\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 545,\n              columnNumber: 39\n            }, this),\n            color: \"green-bg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 542,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 535,\n          columnNumber: 25\n        }, this), Object.entries(manualClusters).sort(([timeA], [timeB]) => {\n          const tA = timeA.padStart(5, \"0\");\n          const tB = timeB.padStart(5, \"0\");\n          return tA.localeCompare(tB);\n        }).map(([pickupTime, clusters]) => {\n          const totalRoutes = Object.keys(clusters).length;\n          const totalEmployees = Object.values(clusters).reduce((total, clusterData) => {\n            var _clusterData$employee2;\n            return total + ((clusterData === null || clusterData === void 0 ? void 0 : (_clusterData$employee2 = clusterData.employeeList) === null || _clusterData$employee2 === void 0 ? void 0 : _clusterData$employee2.length) || 0);\n          }, 0);\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pickuptime-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pickuptime-with-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                children: [\"Pickup Time: \", pickupTime]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 567,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n                children: [\"Total Routes: \", totalRoutes]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 568,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n                children: [\"Total Employees: \", totalEmployees]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 569,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => addNewCluster(pickupTime),\n                className: \"add-cluster-btn\",\n                children: [/*#__PURE__*/_jsxDEV(FaPlus, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 574,\n                  columnNumber: 49\n                }, this), \" Add Cluster\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 570,\n                columnNumber: 45\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 566,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"clusters-container\",\n              children: Object.entries(clusters).map(([clusterId, clusterData]) => {\n                const employeeList = (clusterData === null || clusterData === void 0 ? void 0 : clusterData.employeeList) || [];\n                const routeName = (clusterData === null || clusterData === void 0 ? void 0 : clusterData.routeName) || \"\";\n                const vehicleDetails = clusterData === null || clusterData === void 0 ? void 0 : clusterData.vehicleDetails;\n                const isOptimized = routingStatus[`${pickupTime}__${clusterId}`];\n                return /*#__PURE__*/_jsxDEV(Droppable, {\n                  droppableId: `${pickupTime}__${clusterId}`,\n                  children: provided => /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"cluster-card\",\n                    ref: provided.innerRef,\n                    ...provided.droppableProps,\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"cluster-card-with-vechile\",\n                      children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                        children: clusterId\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 596,\n                        columnNumber: 69\n                      }, this), isOptimized ? routingStatus[`${pickupTime}__${clusterId}`] === \"Trip in progress\" ? /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"trip-in-progress\",\n                        children: \"Trip Started\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 600,\n                        columnNumber: 77\n                      }, this) : /*#__PURE__*/_jsxDEV(IoCheckmarkCircleOutline, {\n                        className: \"optimized-check-icon\",\n                        size: 20,\n                        color: \"green\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 604,\n                        columnNumber: 77\n                      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                        onClick: () => handleProceed(pickupTime, clusterId),\n                        className: \"optimize-routing-btn\",\n                        children: [/*#__PURE__*/_jsxDEV(FaArrowRight, {}, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 617,\n                          columnNumber: 77\n                        }, this), \" Assign Vehicle\"]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 611,\n                        columnNumber: 73\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 595,\n                      columnNumber: 65\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"cluster-card-with-vechile\",\n                      children: [/*#__PURE__*/_jsxDEV(Dropdown, {\n                        options: [\"\", ...vechilesList.map(option => `${option.vechile_number} - ${option.vechile_owner_name}`)],\n                        className: \"vechile-dropdown\",\n                        htmlFor: \"vechile\",\n                        id: \"vechile\",\n                        label: \"\",\n                        value: vehicleDetails ? `${vehicleDetails.vechile_number} - ${vehicleDetails.vechile_owner_name}` : \"\",\n                        onChange: e => {\n                          const selectedValue = e.target.value.trim();\n                          if (selectedValue === \"\") {\n                            setManualClusters(prev => ({\n                              ...prev,\n                              [pickupTime]: {\n                                ...prev[pickupTime],\n                                [clusterId]: {\n                                  ...prev[pickupTime][clusterId],\n                                  vehicleDetails: null\n                                }\n                              }\n                            }));\n                            return;\n                          }\n                          const selectedVehicle = vechilesList.find(v => `${v.vechile_number} - ${v.vechile_owner_name}` === selectedValue);\n                          if (selectedVehicle && (!vehicleDetails || selectedVehicle.vechile_id !== vehicleDetails.vechile_id)) {\n                            setManualClusters(prev => ({\n                              ...prev,\n                              [pickupTime]: {\n                                ...prev[pickupTime],\n                                [clusterId]: {\n                                  ...prev[pickupTime][clusterId],\n                                  vehicleDetails: selectedVehicle\n                                }\n                              }\n                            }));\n                            const payload = employeeList.map(employee => ({\n                              vehicle_id: selectedVehicle.id,\n                              employee_id: employee.employee_id,\n                              schedule_id: employee.schedule_id\n                            }));\n                            if (payload.length === 0) {\n                              console.error(\"No employees in the cluster.\");\n                              return;\n                            }\n                            setApiProps({\n                              method: \"POST\",\n                              url: \"api/update/pickup-vehicles\",\n                              postData: JSON.stringify(payload),\n                              render: response => {\n                                if (response.status === 200) {\n                                  var _employeeList$2;\n                                  success(\"Vehicles updated for all employees in the cluster.\");\n                                  fetchRoutingDetails([pickupTime], (_employeeList$2 = employeeList[0]) === null || _employeeList$2 === void 0 ? void 0 : _employeeList$2.shift_date);\n                                } else {\n                                  error((response === null || response === void 0 ? void 0 : response.message) || \"Failed to update vehicles.\");\n                                }\n                              }\n                            });\n                          }\n                        },\n                        onFocus: e => {\n                          const currentValue = e.target.value;\n                          e.target.value = \"\";\n                          setTimeout(() => {\n                            e.target.value = currentValue;\n                          }, 0);\n                        },\n                        placeholder: \"Vehicle No\",\n                        name: \"vechileNo\",\n                        dropDownList: \"vechilesList\",\n                        disabled: !editable[`${pickupTime}__${clusterId}`]\n                      }, vechilesList.map(option => option.vechile_id).join(\"-\"), false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 622,\n                        columnNumber: 69\n                      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                        onClick: () => setMapClusterData(employeeList),\n                        disabled: employeeList.length === 0,\n                        className: \"view-map-button\",\n                        children: \"Map\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 730,\n                        columnNumber: 69\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 621,\n                      columnNumber: 65\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"cluster-route-info\",\n                      children: /*#__PURE__*/_jsxDEV(\"h6\", {\n                        children: [\"Route Name : \", /*#__PURE__*/_jsxDEV(\"span\", {\n                          children: routeName\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 740,\n                          columnNumber: 86\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 739,\n                        columnNumber: 69\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 738,\n                      columnNumber: 65\n                    }, this), employeeList.length === 0 && /*#__PURE__*/_jsxDEV(\"button\", {\n                      onClick: () => {\n                        const updated = {\n                          ...manualClusters\n                        };\n                        delete updated[pickupTime][clusterId];\n                        setManualClusters(updated);\n                      },\n                      className: \"remove-cluster-btn\",\n                      children: \"\\u2715\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 744,\n                      columnNumber: 69\n                    }, this), employeeList.map((emp, idx) => {\n                      const editKey = `${pickupTime}__${clusterId}__${idx}`;\n                      return /*#__PURE__*/_jsxDEV(Draggable, {\n                        draggableId: emp.employee_id,\n                        index: idx,\n                        children: provided => /*#__PURE__*/_jsxDEV(\"div\", {\n                          className: \"employee-card\",\n                          ref: provided.innerRef,\n                          ...provided.draggableProps,\n                          ...provided.dragHandleProps,\n                          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                            children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                              children: emp.employee_name || \"Unnamed\"\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 771,\n                              columnNumber: 89\n                            }, this)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 770,\n                            columnNumber: 85\n                          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                              src: \"/Images/5172573_location_map_icon.png\",\n                              className: \"location-icon\"\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 774,\n                              columnNumber: 89\n                            }, this), emp.employee_address || \"No address\"]\n                          }, void 0, true, {\n                            fileName: _jsxFileName,\n                            lineNumber: 773,\n                            columnNumber: 85\n                          }, this), emp.calculated_pickup_time && /*#__PURE__*/_jsxDEV(_Fragment, {\n                            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                                src: \"/Images/3859125_app_hour_interface_time_timer_icon.png\",\n                                className: \"clock-icon\"\n                              }, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 783,\n                                columnNumber: 97\n                              }, this), \"Pickup Time:\", \" \", editable[editKey] ? /*#__PURE__*/_jsxDEV(TimePicker, {\n                                onChange: val => updateEmployeeValue(pickupTime, clusterId, idx, \"calculated_pickup_time\", val + \":00\"),\n                                value: getValidTime(emp.calculated_pickup_time),\n                                disableClock: true,\n                                format: \"HH:mm\",\n                                clearIcon: null,\n                                locale: \"en-GB\"\n                              }, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 789,\n                                columnNumber: 101\n                              }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n                                children: emp.calculated_pickup_time || \"N/A\"\n                              }, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 808,\n                                columnNumber: 101\n                              }, this)]\n                            }, void 0, true, {\n                              fileName: _jsxFileName,\n                              lineNumber: 782,\n                              columnNumber: 93\n                            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                              children: [\"\\uD83D\\uDE97 Sequence:\", \" \", editable[editKey] ? /*#__PURE__*/_jsxDEV(\"input\", {\n                                type: \"number\",\n                                min: \"1\",\n                                value: emp.pickup_sequence || \"\",\n                                onChange: e => updateEmployeeValue(pickupTime, clusterId, idx, \"pickup_sequence\", parseInt(e.target.value, 10))\n                              }, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 816,\n                                columnNumber: 101\n                              }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n                                className: \"drop-seqence\",\n                                children: emp.pickup_sequence || \"N/A\"\n                              }, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 831,\n                                columnNumber: 101\n                              }, this)]\n                            }, void 0, true, {\n                              fileName: _jsxFileName,\n                              lineNumber: 813,\n                              columnNumber: 93\n                            }, this)]\n                          }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n                            onClick: () => toggleEdit(pickupTime, clusterId, idx),\n                            children: editable[editKey] ? \"Save\" : \"Edit\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 838,\n                            columnNumber: 85\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 764,\n                          columnNumber: 81\n                        }, this)\n                      }, emp.employee_id, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 758,\n                        columnNumber: 73\n                      }, this);\n                    }), provided.placeholder]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 590,\n                    columnNumber: 61\n                  }, this)\n                }, `${pickupTime}__${clusterId}`, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 585,\n                  columnNumber: 53\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 577,\n              columnNumber: 41\n            }, this)]\n          }, pickupTime, true, {\n            fileName: _jsxFileName,\n            lineNumber: 565,\n            columnNumber: 37\n          }, this);\n        })]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 534,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 524,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 511,\n    columnNumber: 9\n  }, this);\n};\n_s(PickupGroupingSchedules, \"4FlKLTvhx4GIxYEK6jIctrrTDSk=\");\n_c2 = PickupGroupingSchedules;\nexport default PickupGroupingSchedules;\nvar _c, _c2;\n$RefreshReg$(_c, \"StatsCard\");\n$RefreshReg$(_c2, \"PickupGroupingSchedules\");","map":{"version":3,"names":["React","useCallback","useEffect","useState","useRef","ApiComponent","DatePicker","DragDropContext","Droppable","Draggable","FaPlus","FaArrowRight","IoCheckmarkCircleOutline","TimePicker","Dropdown","ClusterMapModal","ToastComponent","TrendingUp","TrendingDown","DollarSign","Users","FileText","CheckCircle","Bus","jsxDEV","_jsxDEV","Fragment","_Fragment","StatsCard","label","value","icon","color","footer","trend","className","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","PickupGroupingSchedules","_s","info","error","success","manualClusters","setManualClusters","selectedDate","setSelectedDate","Date","apiProps","setApiProps","editable","setEditable","vechilesList","setVechileList","mapClusterData","setMapClusterData","routingStatus","setRoutingStatus","prevManualClustersRef","totalRoutes","Object","keys","reduce","acc","pickupTime","length","totalEmployees","values","clusters","clusterAcc","clusterData","_clusterData$employee","employeeList","prevManualClusters","current","JSON","stringify","groupedByDate","Map","entries","forEach","clusterId","cluster","_employeeList$","shiftDate","shift_date","has","set","Set","get","add","pickupTimesSet","pickupTimes","Array","from","fetchRoutingDetails","method","url","postData","pickup_time","render","detailsResponse","status","isArray","data","allRoutingData","filter","item","routing","includes","pickup_trip_status","updatedClusters","newRoutingStatus","clustersToRemove","_item$vehicle","_item$vehicle2","_item$vehicle3","group","schedule","cluster_id","vehicleNumber","vehicle","vechile_number","vechile_id","vehicleOwnerName","vechile_owner_name","currentCluster","vehicleDetails","employees","clusterKey","split","prev","fetchSchedules","fetchVehicleList","date","onComplete","formattedDate","toISOString","response","optimizedRoutes","optimized_routes","initialClusters","route","pickup_time_group","cl","idx","pickup_sequence","routeName","route_name","console","onError","saveClusterChanges","empIndex","_cluster$employeeList","employee","calculated_pickup_time","distance_from_last","cumulative_distance","payload","employee_id","schedule_id","message","addNewCluster","newClusterId","handleProceed","postCluster","_cluster$employeeList2","result","updated","newRoute","find","r","tripStatus","trip_status","warn","onDragEnd","source","destination","droppableId","index","sourceTime","sourceCluster","destTime","destCluster","sourceItems","destItems","movedItem","splice","some","emp","isoDate","updateEmployeeValue","key","toggleEdit","wasEditing","getValidTime","timeStr","match","onClose","selected","onChange","src","alt","sort","timeA","timeB","tA","padStart","tB","localeCompare","map","total","_clusterData$employee2","onClick","isOptimized","provided","ref","innerRef","droppableProps","size","options","option","htmlFor","id","e","selectedValue","target","trim","selectedVehicle","v","vehicle_id","_employeeList$2","onFocus","currentValue","setTimeout","placeholder","name","dropDownList","disabled","join","editKey","draggableId","draggableProps","dragHandleProps","employee_name","employee_address","val","disableClock","format","clearIcon","locale","type","min","parseInt","_c2","$RefreshReg$"],"sources":["C:/Users/annavarapu.7/Transport-frontend/src/Pages/Schedules/PickupGroupingSchedules.js"],"sourcesContent":["import React, { useCallback, useEffect, useState, useRef } from 'react';\r\nimport ApiComponent from '../../Components/API';\r\nimport DatePicker from 'react-datepicker';\r\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';\r\nimport { FaPlus, FaArrowRight } from 'react-icons/fa';\r\nimport { IoCheckmarkCircleOutline } from 'react-icons/io5';\r\nimport TimePicker from 'react-time-picker';\r\nimport Dropdown from '../../Components/Dropdown';\r\nimport ClusterMapModal from '../../Components/ClusterMapModel';\r\nimport ToastComponent from '../../Components/Toast';\r\nimport {\r\n    TrendingUp,\r\n    TrendingDown,\r\n    DollarSign,\r\n    Users,\r\n    FileText,\r\n    CheckCircle,\r\n    Bus,\r\n} from 'lucide-react';\r\nimport 'react-datepicker/dist/react-datepicker.css';\r\nimport 'react-time-picker/dist/TimePicker.css';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\nconst StatsCard = ({ label, value, icon, color, footer, trend }) => (\r\n    <div className=\"stats-card\">\r\n        <div className=\"card-top\">\r\n            <div>\r\n                <p className=\"card-label\">{label}</p>\r\n                <p className=\"card-value\">{value}</p>\r\n            </div>\r\n            <div className={`icon-container ${color}`}>{icon}</div>\r\n        </div>\r\n        {/* {footer && (\r\n      <div className=\"card-footer\">\r\n        {trend === 'up' && <TrendingUp className=\"trend-icon green\" />}\r\n        {trend === 'down' && <TrendingDown className=\"trend-icon red\" />}\r\n        <span className={`trend-value ${trend === 'up' ? 'green' : 'red'}`}>\r\n          {footer.split(' ')[0]}\r\n        </span>\r\n        <span className=\"trend-text\">{footer.split(' ').slice(1).join(' ')}</span>\r\n      </div>\r\n    )} */}\r\n    </div>\r\n);\r\n\r\nconst PickupGroupingSchedules = () => {\r\n    const { info, error, success } = ToastComponent();\r\n    const [manualClusters, setManualClusters] = useState({});\r\n    const [selectedDate, setSelectedDate] = useState(() => new Date());\r\n    const [apiProps, setApiProps] = useState(null);\r\n    const [editable, setEditable] = useState({});\r\n    const [vechilesList, setVechileList] = useState([]);\r\n    const [mapClusterData, setMapClusterData] = useState(null);\r\n    const [routingStatus, setRoutingStatus] = useState({});\r\n    const prevManualClustersRef = useRef();\r\n\r\n\r\n    const totalRoutes = Object.keys(manualClusters).reduce((acc, pickupTime) => {\r\n    return acc + Object.keys(manualClusters[pickupTime]).length;\r\n}, 0);\r\n\r\n    const totalEmployees = Object.values(manualClusters).reduce((acc, clusters) => {\r\n    return acc + Object.values(clusters).reduce((clusterAcc, clusterData) => {\r\n        return clusterAcc + (clusterData?.employeeList?.length || 0);\r\n    }, 0);\r\n}, 0);\r\n\r\n\r\n    useEffect(() => {\r\n        const prevManualClusters = prevManualClustersRef.current;\r\n        if (prevManualClusters && JSON.stringify(prevManualClusters) !== JSON.stringify(manualClusters)) {\r\n            const groupedByDate = new Map(); // Map<shiftDate, Set<pickupTime>>\r\n\r\n            Object.entries(manualClusters).forEach(([pickupTime, clusters]) => {\r\n                Object.entries(clusters).forEach(([clusterId, cluster]) => {\r\n                    const employeeList = cluster.employeeList;\r\n                    const shiftDate = employeeList && employeeList[0]?.shift_date;\r\n\r\n                    if (shiftDate) {\r\n                        if (!groupedByDate.has(shiftDate)) {\r\n                            groupedByDate.set(shiftDate, new Set());\r\n                        }\r\n                        groupedByDate.get(shiftDate).add(pickupTime);\r\n                    }\r\n                });\r\n            });\r\n\r\n            // Send one request per shift date with all its pickup times\r\n            groupedByDate.forEach((pickupTimesSet, shiftDate) => {\r\n                const pickupTimes = Array.from(pickupTimesSet);\r\n                fetchRoutingDetails(pickupTimes, shiftDate);\r\n            });\r\n        }\r\n        prevManualClustersRef.current = manualClusters;\r\n    }, [manualClusters]);\r\n\r\n\r\n    const fetchRoutingDetails = (pickupTimes, shiftDate) => {\r\n        setApiProps({\r\n            method: 'POST',\r\n            url: 'api/get/pickup/routing-details',\r\n            postData: JSON.stringify({\r\n                pickup_time: pickupTimes,  // Now an array\r\n                shift_date: shiftDate\r\n            }),\r\n            render: (detailsResponse) => {\r\n                if (detailsResponse.status === 200 && Array.isArray(detailsResponse.data.data)) {\r\n\r\n                    // Filter for both 'Routing Done', 'Picked Up', and 'Completed' statuses\r\n                    const allRoutingData = detailsResponse.data.data.filter(item =>\r\n                        item.routing && ['Routing Done', 'Picked Up', 'Completed'].includes(item.routing.pickup_trip_status)\r\n                    );\r\n\r\n                    if (allRoutingData.length > 0) {\r\n                        setManualClusters(prevManualClusters => {\r\n                            const updatedClusters = { ...prevManualClusters };\r\n                            const newRoutingStatus = {};\r\n                            const clustersToRemove = new Set(); // To track clusters to be removed\r\n\r\n                            allRoutingData.forEach(item => {\r\n                                const group = item.schedule.pickup_time; // pickup_time is the group\r\n                                const clusterId = item.cluster_id;\r\n                                const vehicleNumber = item?.vehicle?.vechile_number || null;\r\n                                const vechile_id = item?.vehicle?.vechile_id || null;\r\n                                const vehicleOwnerName = item?.vehicle?.vechile_owner_name || null;\r\n                                const employeeList = item.employeeList || []; // Assuming the employee list is in the API response\r\n                                const status = item.routing.pickup_trip_status; // Either 'Routing Done', 'Picked Up', or 'Completed'\r\n\r\n                                // Check if the cluster and group already exist in the state\r\n                                if (updatedClusters[group] && updatedClusters[group][clusterId]) {\r\n                                    const currentCluster = updatedClusters[group][clusterId];\r\n\r\n                                    // Add vehicle details if they are not already set\r\n                                    if (\r\n                                        vehicleNumber &&\r\n                                        (!currentCluster.vehicleDetails || currentCluster.vehicleDetails.vechile_number !== vehicleNumber)\r\n                                    ) {\r\n                                        currentCluster.vehicleDetails = {\r\n                                            vechile_number: vehicleNumber,\r\n                                            vechile_owner_name: vehicleOwnerName,\r\n                                            vechile_id: vechile_id\r\n                                        };\r\n                                    }\r\n\r\n                                    // Replace the current employees with the new employeeList\r\n                                    if (Array.isArray(employeeList) && employeeList.length > 0) {\r\n                                        currentCluster.employees = employeeList; // Replace employees with employeeList from the API\r\n                                    }\r\n\r\n                                    // Set routing status to either 'completed' or 'routing done', or 'Trip in progress' for 'Picked Up'\r\n                                    if (status === 'Completed') {\r\n                                        newRoutingStatus[`${group}__${clusterId}`] = 'completed';\r\n                                    } else if (status === 'Picked Up') {\r\n                                        newRoutingStatus[`${group}__${clusterId}`] = 'Trip in progress'; // Update here\r\n                                    } else {\r\n                                        newRoutingStatus[`${group}__${clusterId}`] = 'routing done';\r\n                                    }\r\n\r\n                                    // If the status is 'Completed', we need to mark this cluster for removal\r\n                                    if (status === 'Completed') {\r\n                                        clustersToRemove.add(`${group}__${clusterId}`);\r\n                                    }\r\n                                }\r\n                            });\r\n\r\n                            // Remove the clusters that are marked for removal\r\n                            clustersToRemove.forEach(clusterKey => {\r\n                                const [pickupTime, clusterId] = clusterKey.split('__');\r\n                                if (updatedClusters[pickupTime] && updatedClusters[pickupTime][clusterId]) {\r\n                                    delete updatedClusters[pickupTime][clusterId];\r\n\r\n                                    // If the pickup group has no clusters left, delete the entire pickup group\r\n                                    if (Object.keys(updatedClusters[pickupTime]).length === 0) {\r\n                                        delete updatedClusters[pickupTime];\r\n                                    }\r\n                                }\r\n                            });\r\n\r\n                            // Filter out any pickup groups that are empty (i.e., they don't have any clusters after removal)\r\n                            Object.keys(updatedClusters).forEach(group => {\r\n                                if (Object.keys(updatedClusters[group]).length === 0) {\r\n                                    delete updatedClusters[group]; // Remove the empty pickup group\r\n                                }\r\n                            });\r\n\r\n                            // Update routing status\r\n                            setRoutingStatus(prev => ({\r\n                                ...prev,\r\n                                ...newRoutingStatus\r\n                            }));\r\n\r\n                            // Return the updated clusters after filtering out empty groups\r\n                            return updatedClusters;\r\n                        });\r\n                    } else {\r\n                        // Handle case where no routing data is available\r\n                        // info('No routing data found for the selected date.');\r\n                    }\r\n                } else {\r\n                    error(\"Failed to fetch routing details.\");\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n\r\n\r\n\r\n    // Fetch schedules on date change\r\n    useEffect(() => {\r\n        if (selectedDate) {\r\n            fetchSchedules(selectedDate, () => {\r\n                fetchVehicleList();\r\n            });\r\n        }\r\n    }, [selectedDate]);\r\n\r\n    const fetchSchedules = (date, onComplete) => {\r\n        const formattedDate = date.toISOString().split('T')[0];\r\n\r\n        setApiProps({\r\n            method: 'POST',\r\n            url: 'api/get/pickup/clustered-routes',\r\n            postData: { date: formattedDate },\r\n            render: (response) => {\r\n                const optimizedRoutes = response.data.optimized_routes || [];\r\n                const initialClusters = {};\r\n                optimizedRoutes.forEach(route => {\r\n                    const pickupTime = route.pickup_time_group;\r\n                    const clusters = {};\r\n                    route.clusters.forEach((cl, idx) => {\r\n                        clusters[`cluster${idx + 1}`] = {\r\n                            employeeList: cl.pickup_sequence,\r\n                            routeName: cl.route_name,\r\n                            vehicleDetails: null\r\n                        };\r\n                    });\r\n                    initialClusters[pickupTime] = clusters;\r\n                });\r\n                setManualClusters(initialClusters);\r\n                setRoutingStatus({});\r\n                if (onComplete) onComplete(); // Trigger next step\r\n            }\r\n        });\r\n    };\r\n\r\n    // Fetch vehicle list\r\n    const fetchVehicleList = () => {\r\n        if (vechilesList.length === 0) {\r\n            setApiProps({\r\n                method: 'GET',\r\n                url: 'api/get/vechile/all',\r\n                render: (response) => {\r\n                    if (response) {\r\n                        setVechileList(response.data);\r\n                    } else {\r\n                        console.error('No response received from API');\r\n                    }\r\n                },\r\n                onError: (error) => {\r\n                    console.error('Error fetching vehicles:', error);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    // Save cluster changes\r\n    const saveClusterChanges = (pickupTime, clusterId, empIndex) => {\r\n        const cluster = manualClusters[pickupTime][clusterId];\r\n\r\n        if (!cluster) {\r\n            console.error(\"Cluster not found.\");\r\n            return;\r\n        }\r\n\r\n        const shiftDate = cluster.employeeList[0]?.shift_date;\r\n        const employee = cluster.employeeList[empIndex];\r\n        if (!employee) {\r\n            console.error('Employee not found at the given index');\r\n            return;\r\n        }\r\n\r\n        // Update the relevant employee's details\r\n        cluster.employeeList[empIndex] = {\r\n            ...employee,\r\n            pickup_sequence: employee.pickup_sequence,  // (if modified)\r\n            calculated_pickup_time: employee.calculated_pickup_time,  // (if modified)\r\n            distance_from_last: employee.distance_from_last || 0,  // Handle undefined\r\n            cumulative_distance: employee.cumulative_distance || 0,  // Handle undefined\r\n        };\r\n\r\n\r\n        const payload = {\r\n            clusters: manualClusters,\r\n            date: shiftDate,\r\n        };\r\n\r\n        setApiProps({\r\n            method: 'PUT',\r\n            url: `api/get/pickup/updated/manual-clustered-details/${employee.employee_id}/${employee.schedule_id}`,\r\n            postData: JSON.stringify(payload),  // Ensure the payload is stringified\r\n            render: (response) => {\r\n                if (response.status === 200) {\r\n                    success(\"Changes saved successfully.\");\r\n                    fetchRoutingDetails([pickupTime], shiftDate);\r\n                } else {\r\n                    error(response?.message || \"Failed to save changes.\");\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n\r\n    // Add a new cluster to the pickup time\r\n    const addNewCluster = (pickupTime) => {\r\n        setManualClusters((prev) => {\r\n            const current = prev[pickupTime] || {};\r\n            const newClusterId = `cluster${Object.keys(current).length + 1}`;\r\n            return {\r\n                ...prev,\r\n                [pickupTime]: {\r\n                    ...current,\r\n                    [newClusterId]: {\r\n                        employeeList: [],\r\n                        vehicleDetails: null\r\n                    }\r\n                }\r\n            };\r\n        });\r\n    };\r\n\r\n\r\n    // Handle \"Optimize Routing\" button click\r\n    const handleProceed = useCallback((pickupTime, clusterId) => {\r\n        const cluster = manualClusters[pickupTime][clusterId];\r\n        if (!cluster.vehicleDetails) {\r\n            ToastComponent().error(\"Please select a vehicle\");\r\n            return;\r\n        }\r\n\r\n        const postCluster = {\r\n            [pickupTime]: [{\r\n                ...cluster,\r\n                clusterId: clusterId\r\n            }]\r\n        };\r\n\r\n\r\n\r\n        setApiProps({\r\n            method: 'POST',\r\n            url: 'api/get/pickup-routing',\r\n            postData: JSON.stringify(postCluster),\r\n\r\n            render: (response) => {\r\n                const result = response.data;\r\n\r\n                if (!result || !result.route || !Array.isArray(result.route)) {\r\n                    console.error(\"Invalid response format: 'route' array not found\", result);\r\n                    error(\"Failed to update routing. Invalid response format.\");\r\n                    return;\r\n                }\r\n\r\n                const updated = { ...manualClusters };\r\n                const newRoute = result.route.find(r => r.pickup_time_group === pickupTime);\r\n\r\n                if (newRoute) {\r\n                    newRoute.clusters.forEach((cl, idx) => {\r\n                        const clusterKey = Object.keys(updated[pickupTime])[idx] || `cluster${idx + 1}`;\r\n                        updated[pickupTime][clusterKey].employeeList = cl.pickup_sequence;\r\n\r\n                        const tripStatus = cl.trip_status;\r\n                        if (tripStatus) {\r\n                            setRoutingStatus(prev => ({\r\n                                ...prev,\r\n                                [`${pickupTime}__${clusterKey}`]: tripStatus\r\n                            }));\r\n                        }\r\n                        // saveClusterChanges(pickupTime, clusterKey);\r\n                    });\r\n                }\r\n\r\n                setManualClusters(updated);\r\n\r\n                // âœ… Get shift_date from first employee in the cluster\r\n                const shiftDate = cluster.employeeList[0]?.shift_date;\r\n                if (shiftDate) {\r\n                    fetchRoutingDetails([pickupTime], shiftDate);  // Send as list\r\n                } else {\r\n                    console.warn(\"Shift date not found in cluster data\");\r\n                }\r\n            }\r\n        });\r\n    }, [manualClusters, success, error, info]);\r\n\r\n\r\n\r\n    // Handle drag-and-drop behavior\r\n    const onDragEnd = (result) => {\r\n        const { source, destination } = result;\r\n        if (!destination || (source.droppableId === destination.droppableId && source.index === destination.index)) return;\r\n\r\n        const [sourceTime, sourceCluster] = source.droppableId.split('__');\r\n        const [destTime, destCluster] = destination.droppableId.split('__');\r\n        if (sourceTime !== destTime) return;\r\n\r\n        const sourceItems = Array.from(manualClusters[sourceTime][sourceCluster].employeeList);\r\n        const destItems = Array.from(manualClusters[destTime][destCluster].employeeList);\r\n        const [movedItem] = sourceItems.splice(source.index, 1);\r\n\r\n        // Prevent moving an employee if they already exist in the destination\r\n        if (destItems.some(emp => emp.employee_id === movedItem.employee_id)) return;\r\n\r\n        // Move the item to the destination\r\n        destItems.splice(destination.index, 0, movedItem);\r\n\r\n\r\n        // Update the clusters with the new data\r\n        const updatedClusters = {\r\n            ...manualClusters,\r\n            [sourceTime]: {\r\n                ...manualClusters[sourceTime],\r\n                [sourceCluster]: {\r\n                    ...manualClusters[sourceTime][sourceCluster],\r\n                    employeeList: sourceItems\r\n                },\r\n                [destCluster]: {\r\n                    ...manualClusters[destTime][destCluster],\r\n                    employeeList: destItems\r\n                }\r\n            }\r\n        };\r\n\r\n        // Remove any empty clusters before sending the data to the API\r\n        Object.keys(updatedClusters[sourceTime]).forEach(cluster => {\r\n            if (updatedClusters[sourceTime][cluster].employeeList.length === 0) {\r\n                delete updatedClusters[sourceTime][cluster];\r\n            }\r\n        });\r\n        Object.keys(updatedClusters[destTime]).forEach(cluster => {\r\n            if (updatedClusters[destTime][cluster].employeeList.length === 0) {\r\n                delete updatedClusters[destTime][cluster];\r\n            }\r\n        });\r\n\r\n        setManualClusters(updatedClusters);\r\n\r\n        // Update routing status\r\n        setRoutingStatus(prev => ({\r\n            ...prev,\r\n            [`${sourceTime}__${sourceCluster}`]: false,\r\n            [`${destTime}__${destCluster}`]: false\r\n        }));\r\n\r\n        const shiftDate = movedItem?.shift_date || new Date().toISOString().split(\"T\")[0];\r\n        const isoDate = `${shiftDate}T${sourceTime}`;\r\n\r\n        const payload = {\r\n            clusters: updatedClusters,\r\n            date: isoDate, // Correct ISO 8601 format\r\n        };\r\n\r\n        // Call the API to save the updated clusters\r\n        setApiProps({\r\n            method: 'POST',\r\n            url: 'api/get/pickup/updated/manual-clustered-routes',\r\n            postData: JSON.stringify(payload),  // Ensure payload is stringified\r\n            render: (response) => {\r\n                if (response.status === 200) {\r\n                    success(\"Saved successfully.\");\r\n                    fetchSchedules(shiftDate);\r\n                } else {\r\n                    error(response?.message || \"Failed to save changes.\");\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n    // Update employee values\r\n    const updateEmployeeValue = (pickupTime, clusterId, empIndex, key, value) => {\r\n        setManualClusters(prev => {\r\n            const updated = { ...prev };\r\n            const cluster = [...updated[pickupTime][clusterId].employeeList];\r\n            cluster[empIndex][key] = value;\r\n            updated[pickupTime][clusterId].employeeList = cluster;\r\n            return updated;\r\n        });\r\n    };\r\n\r\n    const toggleEdit = (pickupTime, clusterId, empIndex) => {\r\n        const key = `${pickupTime}__${clusterId}__${empIndex}`;\r\n        const wasEditing = editable[key];\r\n        setEditable(prev => ({ ...prev, [key]: !prev[key] }));\r\n        if (wasEditing === true) {\r\n            saveClusterChanges(pickupTime, clusterId, empIndex);\r\n        }\r\n    };\r\n\r\n    const getValidTime = (timeStr) => {\r\n        if (!timeStr || typeof timeStr !== 'string') return '00:00';\r\n        const match = timeStr.match(/^(\\d{2}):(\\d{2})/);\r\n        return match ? match[0] : '00:00';\r\n    };\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"pick-grouping-main-container\">\r\n            {apiProps && <ApiComponent {...apiProps} />}\r\n            {mapClusterData && <ClusterMapModal clusterData={mapClusterData} onClose={() => setMapClusterData(null)} />}\r\n            <div className='grouping-schediles-with-datepicker-container'>\r\n                <h2>Pickup Schedules</h2>\r\n                <DatePicker\r\n                    selected={selectedDate}\r\n                    onChange={(date) => {\r\n                        if (date) setSelectedDate(date);\r\n                    }}\r\n                    className=\"date-range-picker\"\r\n                />\r\n            </div>\r\n            <DragDropContext onDragEnd={onDragEnd}>\r\n                {Object.keys(manualClusters).length === 0 ? (\r\n                    <div className=\"no-schedules-message\">\r\n                        <img\r\n                            src=\"/Images/897245_clock_manage_schedule_time_icon.png\"\r\n                            alt=\"schedule\"\r\n                        />\r\n                        <p>No schedules available.</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grouped-schedules-list\">\r\n                        <div className=\"stats-grid\">\r\n                            <StatsCard\r\n                                label=\"Total Routes\"\r\n                                value={totalRoutes}\r\n                                icon={<Bus className=\"icon green\" />}\r\n                                color=\"green-bg\"\r\n                            />\r\n                            <StatsCard\r\n                                label=\"Total Employees\"\r\n                                value={totalEmployees}\r\n                                icon={<Users className=\"icon blue\" />}\r\n                                color=\"green-bg\"\r\n                            />\r\n                        </div>\r\n                        {Object.entries(manualClusters)\r\n                            .sort(([timeA], [timeB]) => {\r\n                                const tA = timeA.padStart(5, \"0\");\r\n                                const tB = timeB.padStart(5, \"0\");\r\n                                return tA.localeCompare(tB);\r\n                            })\r\n                            .map(([pickupTime, clusters]) => {\r\n                                const totalRoutes = Object.keys(clusters).length;\r\n                                const totalEmployees = Object.values(clusters).reduce(\r\n                                    (total, clusterData) =>\r\n                                        total +\r\n                                        (clusterData?.employeeList?.length || 0),\r\n                                    0\r\n                                );\r\n\r\n                                return (\r\n                                    <div className=\"pickuptime-group\" key={pickupTime}>\r\n                                        <div className=\"pickuptime-with-actions\">\r\n                                            <h4>Pickup Time: {pickupTime}</h4>\r\n                                            <h5>Total Routes: {totalRoutes}</h5>\r\n                                            <h5>Total Employees: {totalEmployees}</h5>\r\n                                            <button\r\n                                                onClick={() => addNewCluster(pickupTime)}\r\n                                                className=\"add-cluster-btn\"\r\n                                            >\r\n                                                <FaPlus /> Add Cluster\r\n                                            </button>\r\n                                        </div>\r\n                                        <div className=\"clusters-container\">\r\n                                            {Object.entries(clusters).map(([clusterId, clusterData]) => {\r\n                                                const employeeList = clusterData?.employeeList || [];\r\n                                                const routeName = clusterData?.routeName || \"\";\r\n                                                const vehicleDetails = clusterData?.vehicleDetails;\r\n                                                const isOptimized =\r\n                                                    routingStatus[`${pickupTime}__${clusterId}`];\r\n                                                return (\r\n                                                    <Droppable\r\n                                                        droppableId={`${pickupTime}__${clusterId}`}\r\n                                                        key={`${pickupTime}__${clusterId}`}\r\n                                                    >\r\n                                                        {(provided) => (\r\n                                                            <div\r\n                                                                className=\"cluster-card\"\r\n                                                                ref={provided.innerRef}\r\n                                                                {...provided.droppableProps}\r\n                                                            >\r\n                                                                <div className=\"cluster-card-with-vechile\">\r\n                                                                    <h5>{clusterId}</h5>\r\n                                                                    {isOptimized ? (\r\n                                                                        routingStatus[`${pickupTime}__${clusterId}`] ===\r\n                                                                            \"Trip in progress\" ? (\r\n                                                                            <span className=\"trip-in-progress\">\r\n                                                                                Trip Started\r\n                                                                            </span>\r\n                                                                        ) : (\r\n                                                                            <IoCheckmarkCircleOutline\r\n                                                                                className=\"optimized-check-icon\"\r\n                                                                                size={20}\r\n                                                                                color=\"green\"\r\n                                                                            />\r\n                                                                        )\r\n                                                                    ) : (\r\n                                                                        <button\r\n                                                                            onClick={() =>\r\n                                                                                handleProceed(pickupTime, clusterId)\r\n                                                                            }\r\n                                                                            className=\"optimize-routing-btn\"\r\n                                                                        >\r\n                                                                            <FaArrowRight /> Assign Vehicle\r\n                                                                        </button>\r\n                                                                    )}\r\n                                                                </div>\r\n                                                                <div className=\"cluster-card-with-vechile\">\r\n                                                                    <Dropdown\r\n                                                                        options={[\r\n                                                                            \"\",\r\n                                                                            ...vechilesList.map(\r\n                                                                                (option) =>\r\n                                                                                    `${option.vechile_number} - ${option.vechile_owner_name}`\r\n                                                                            ),\r\n                                                                        ]}\r\n                                                                        key={vechilesList\r\n                                                                            .map((option) => option.vechile_id)\r\n                                                                            .join(\"-\")}\r\n                                                                        className=\"vechile-dropdown\"\r\n                                                                        htmlFor=\"vechile\"\r\n                                                                        id=\"vechile\"\r\n                                                                        label=\"\"\r\n                                                                        value={\r\n                                                                            vehicleDetails\r\n                                                                                ? `${vehicleDetails.vechile_number} - ${vehicleDetails.vechile_owner_name}`\r\n                                                                                : \"\"\r\n                                                                        }\r\n                                                                        onChange={(e) => {\r\n                                                                            const selectedValue = e.target.value.trim();\r\n\r\n                                                                            if (selectedValue === \"\") {\r\n                                                                                setManualClusters((prev) => ({\r\n                                                                                    ...prev,\r\n                                                                                    [pickupTime]: {\r\n                                                                                        ...prev[pickupTime],\r\n                                                                                        [clusterId]: {\r\n                                                                                            ...prev[pickupTime][clusterId],\r\n                                                                                            vehicleDetails: null,\r\n                                                                                        },\r\n                                                                                    },\r\n                                                                                }));\r\n                                                                                return;\r\n                                                                            }\r\n\r\n                                                                            const selectedVehicle = vechilesList.find(\r\n                                                                                (v) =>\r\n                                                                                    `${v.vechile_number} - ${v.vechile_owner_name}` ===\r\n                                                                                    selectedValue\r\n                                                                            );\r\n\r\n                                                                            if (\r\n                                                                                selectedVehicle &&\r\n                                                                                (!vehicleDetails ||\r\n                                                                                    selectedVehicle.vechile_id !==\r\n                                                                                    vehicleDetails.vechile_id)\r\n                                                                            ) {\r\n                                                                                setManualClusters((prev) => ({\r\n                                                                                    ...prev,\r\n                                                                                    [pickupTime]: {\r\n                                                                                        ...prev[pickupTime],\r\n                                                                                        [clusterId]: {\r\n                                                                                            ...prev[pickupTime][clusterId],\r\n                                                                                            vehicleDetails: selectedVehicle,\r\n                                                                                        },\r\n                                                                                    },\r\n                                                                                }));\r\n\r\n                                                                                const payload = employeeList.map((employee) => ({\r\n                                                                                    vehicle_id: selectedVehicle.id,\r\n                                                                                    employee_id: employee.employee_id,\r\n                                                                                    schedule_id: employee.schedule_id,\r\n                                                                                }));\r\n\r\n                                                                                if (payload.length === 0) {\r\n                                                                                    console.error(\"No employees in the cluster.\");\r\n                                                                                    return;\r\n                                                                                }\r\n\r\n                                                                                setApiProps({\r\n                                                                                    method: \"POST\",\r\n                                                                                    url: \"api/update/pickup-vehicles\",\r\n                                                                                    postData: JSON.stringify(payload),\r\n                                                                                    render: (response) => {\r\n                                                                                        if (response.status === 200) {\r\n                                                                                            success(\r\n                                                                                                \"Vehicles updated for all employees in the cluster.\"\r\n                                                                                            );\r\n                                                                                            fetchRoutingDetails(\r\n                                                                                                [pickupTime],\r\n                                                                                                employeeList[0]?.shift_date\r\n                                                                                            );\r\n                                                                                        } else {\r\n                                                                                            error(\r\n                                                                                                response?.message ||\r\n                                                                                                \"Failed to update vehicles.\"\r\n                                                                                            );\r\n                                                                                        }\r\n                                                                                    },\r\n                                                                                });\r\n                                                                            }\r\n                                                                        }}\r\n                                                                        onFocus={(e) => {\r\n                                                                            const currentValue = e.target.value;\r\n                                                                            e.target.value = \"\";\r\n                                                                            setTimeout(() => {\r\n                                                                                e.target.value = currentValue;\r\n                                                                            }, 0);\r\n                                                                        }}\r\n                                                                        placeholder=\"Vehicle No\"\r\n                                                                        name=\"vechileNo\"\r\n                                                                        dropDownList=\"vechilesList\"\r\n                                                                        disabled={\r\n                                                                            !editable[`${pickupTime}__${clusterId}`]\r\n                                                                        }\r\n                                                                    />\r\n                                                                    <button\r\n                                                                        onClick={() => setMapClusterData(employeeList)}\r\n                                                                        disabled={employeeList.length === 0}\r\n                                                                        className=\"view-map-button\"\r\n                                                                    >\r\n                                                                        Map\r\n                                                                    </button>\r\n                                                                </div>\r\n                                                                <div className=\"cluster-route-info\">\r\n                                                                    <h6>\r\n                                                                        Route Name : <span>{routeName}</span>\r\n                                                                    </h6>\r\n                                                                </div>\r\n                                                                {employeeList.length === 0 && (\r\n                                                                    <button\r\n                                                                        onClick={() => {\r\n                                                                            const updated = { ...manualClusters };\r\n                                                                            delete updated[pickupTime][clusterId];\r\n                                                                            setManualClusters(updated);\r\n                                                                        }}\r\n                                                                        className=\"remove-cluster-btn\"\r\n                                                                    >\r\n                                                                        âœ•\r\n                                                                    </button>\r\n                                                                )}\r\n                                                                {employeeList.map((emp, idx) => {\r\n                                                                    const editKey = `${pickupTime}__${clusterId}__${idx}`;\r\n                                                                    return (\r\n                                                                        <Draggable\r\n                                                                            key={emp.employee_id}\r\n                                                                            draggableId={emp.employee_id}\r\n                                                                            index={idx}\r\n                                                                        >\r\n                                                                            {(provided) => (\r\n                                                                                <div\r\n                                                                                    className=\"employee-card\"\r\n                                                                                    ref={provided.innerRef}\r\n                                                                                    {...provided.draggableProps}\r\n                                                                                    {...provided.dragHandleProps}\r\n                                                                                >\r\n                                                                                    <p>\r\n                                                                                        <strong>{emp.employee_name || \"Unnamed\"}</strong>\r\n                                                                                    </p>\r\n                                                                                    <p>\r\n                                                                                        <img\r\n                                                                                            src=\"/Images/5172573_location_map_icon.png\"\r\n                                                                                            className=\"location-icon\"\r\n                                                                                        />\r\n                                                                                        {emp.employee_address || \"No address\"}\r\n                                                                                    </p>\r\n                                                                                    {emp.calculated_pickup_time && (\r\n                                                                                        <>\r\n                                                                                            <p>\r\n                                                                                                <img\r\n                                                                                                    src=\"/Images/3859125_app_hour_interface_time_timer_icon.png\"\r\n                                                                                                    className=\"clock-icon\"\r\n                                                                                                />\r\n                                                                                                Pickup Time:{\" \"}\r\n                                                                                                {editable[editKey] ? (\r\n                                                                                                    <TimePicker\r\n                                                                                                        onChange={(val) =>\r\n                                                                                                            updateEmployeeValue(\r\n                                                                                                                pickupTime,\r\n                                                                                                                clusterId,\r\n                                                                                                                idx,\r\n                                                                                                                \"calculated_pickup_time\",\r\n                                                                                                                val + \":00\"\r\n                                                                                                            )\r\n                                                                                                        }\r\n                                                                                                        value={getValidTime(\r\n                                                                                                            emp.calculated_pickup_time\r\n                                                                                                        )}\r\n                                                                                                        disableClock\r\n                                                                                                        format=\"HH:mm\"\r\n                                                                                                        clearIcon={null}\r\n                                                                                                        locale=\"en-GB\"\r\n                                                                                                    />\r\n                                                                                                ) : (\r\n                                                                                                    <span>\r\n                                                                                                        {emp.calculated_pickup_time || \"N/A\"}\r\n                                                                                                    </span>\r\n                                                                                                )}\r\n                                                                                            </p>\r\n                                                                                            <p>\r\n                                                                                                ðŸš— Sequence:{\" \"}\r\n                                                                                                {editable[editKey] ? (\r\n                                                                                                    <input\r\n                                                                                                        type=\"number\"\r\n                                                                                                        min=\"1\"\r\n                                                                                                        value={emp.pickup_sequence || \"\"}\r\n                                                                                                        onChange={(e) =>\r\n                                                                                                            updateEmployeeValue(\r\n                                                                                                                pickupTime,\r\n                                                                                                                clusterId,\r\n                                                                                                                idx,\r\n                                                                                                                \"pickup_sequence\",\r\n                                                                                                                parseInt(e.target.value, 10)\r\n                                                                                                            )\r\n                                                                                                        }\r\n                                                                                                    />\r\n                                                                                                ) : (\r\n                                                                                                    <span className=\"drop-seqence\">\r\n                                                                                                        {emp.pickup_sequence || \"N/A\"}\r\n                                                                                                    </span>\r\n                                                                                                )}\r\n                                                                                            </p>\r\n                                                                                        </>\r\n                                                                                    )}\r\n                                                                                    <button\r\n                                                                                        onClick={() => toggleEdit(pickupTime, clusterId, idx)}\r\n                                                                                    >\r\n                                                                                        {editable[editKey] ? \"Save\" : \"Edit\"}\r\n                                                                                    </button>\r\n                                                                                </div>\r\n                                                                            )}\r\n                                                                        </Draggable>\r\n                                                                    );\r\n                                                                })}\r\n                                                                {provided.placeholder}\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </Droppable>\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                    </div>\r\n                )}\r\n            </DragDropContext>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PickupGroupingSchedules;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}